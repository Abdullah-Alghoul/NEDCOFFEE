# -*- coding: utf-8 -*-
##############################################################################
#
#
##############################################################################

import logging
logger = logging.getLogger('report_aeroo')

from openerp.report import report_sxw
from openerp.report.report_sxw import rml_parse

import time
from datetime import datetime
from dateutil.relativedelta import relativedelta
DATETIME_FORMAT = "%Y-%m-%d %H:%M:%S"
DATE_FORMAT = "%Y-%m-%d"

class Parser(rml_parse):
    def __init__(self, cr, uid, name, context):
        super(self.__class__, self).__init__(cr, uid, name, context)
        self.cr = cr
        self.uid = uid
        self.lead_planned_revenue = 0.0
        self.opp_planned_revenue = 0.0
        self.total_order = 0.0
        self.localcontext.update({
            'get_vietname_date':self.get_vietname_date,
            'get_vietname_datetime':self.get_vietname_datetime,
            'get_overtime': self.get_overtime,
            'get_company_name': self.get_company_name,
            'get_company_address': self.get_company_address,
            'get_company_phone': self.get_company_phone,
            'get_company_website': self.get_company_website
        })
    
    def get_vietname_date(self, date):
        if not date:
            date = time.strftime(DATE_FORMAT)
        date = datetime.strptime(date, DATE_FORMAT)        
        return date.strftime('%d-%m-%Y')
    
    def get_vietname_datetime(self, date):
        if not date:
            date = time.strftime(DATETIME_FORMAT)
        date = datetime.strptime(date, DATETIME_FORMAT)        
        return date.strftime('%d-%m-%Y')
    
    def get_overtime(self):
        res = []
        sql = "SELECT name FROM hr_overtime_type WHERE active = 'True'"
        self.cr.execute(sql)
        for line in self.cr.dictfetchall():
            res.append({'a': 'a' or '',
                        'b': 'b' or '',
                        'c': 'c' or '',
                        'd': 'd' or '',
                        'name':line['name'] or False, })
        return res
    
    def get_company_name(self):
        sql = "SELECT name FROM res_company"
        self.cr.execute(sql)
        temp = self.cr.fetchone()
        return temp[0]
        
    def get_company_address(self):
        self.cr.execute("SELECT partner_id FROM res_company")
        temp = self.cr.fetchone()
        res_partner = self.pool.get('res.partner').browse(self.cr, self.uid, temp[0])
        return res_partner.street
    
    def get_company_phone(self):
        sql = "SELECT phone FROM res_company"
        self.cr.execute(sql)
        temp = self.cr.fetchone()
        return str(temp[0])
    
    def get_company_website(self):
        self.cr.execute("SELECT partner_id FROM res_company")
        temp = self.cr.fetchone()
        res_partner = self.pool.get('res.partner').browse(self.cr, self.uid, temp[0])
        return res_partner.website
    
# vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4:
